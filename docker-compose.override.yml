services:
  edge:
    build:
      context: ./services/edge
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "asterisk", "-rx", "core show channels concise"]
      interval: 30s
      timeout: 5s
      retries: 3
    volumes:
      # nur diese eine Datei mounten (keine Komplett-Übersteuerung von /etc/asterisk)
      - ./services/edge/etc/asterisk/extensions.conf:/etc/asterisk/extensions.conf:ro
      # Sounds inkl. Cache persistent
      - ./services/edge/asterisk/sounds:/var/lib/asterisk/sounds
    environment:
      # Keys bleiben in .env, diese Zeilen sorgen nur für Durchreichung
      - ELEVENLABS_API_KEY=${ELEVENLABS_API_KEY}
      - ELEVENLABS_VOICE=${ELEVENLABS_VOICE}
      - ELEVENLABS_MODEL=${ELEVENLABS_MODEL}
